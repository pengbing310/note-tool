<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>GitHubé™æ€å¤‡å¿˜å½•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script>
        // æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®ï¼Œæ²¡æœ‰åˆ™è·³è½¬åˆ°é…ç½®é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            const hasConfig = localStorage.getItem('githubMemoConfig');
            const urlParams = new URLSearchParams(window.location.search);
            const hasConfigInUrl = urlParams.has('config');
            
            console.log('æ£€æŸ¥é…ç½®:', { hasConfig, hasConfigInUrl });
            
            if (!hasConfig && !hasConfigInUrl) {
                console.log('æœªæ‰¾åˆ°é…ç½®ï¼Œè·³è½¬åˆ°é…ç½®é¡µé¢');
                window.location.href = 'config.html';
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header>
            <div class="header-content">
                <h1><i class="fas fa-book"></i> GitHubé™æ€å¤‡å¿˜å½•</h1>
                <p class="subtitle">æ•°æ®å­˜å‚¨åœ¨GitHubä»“åº“ï¼Œæ— éœ€ç™»å½•</p>
                
                <!-- æ·»åŠ åˆ†äº«æŒ‰é’® -->
                <div class="header-actions">
                    <button id="shareConfigBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-share-alt"></i> åˆ†äº«é…ç½®
                    </button>
                </div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- å·¦ä¾§ï¼šæ–‡ä»¶å¤¹ -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-folder"></i> æ–‡ä»¶å¤¹</h2>
                    <button id="newFolderBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> æ–°å»º
                    </button>
                </div>
                
                <div class="folders-list" id="foldersList">
                    <!-- æ–‡ä»¶å¤¹å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>åŠ è½½ä¸­...</p>
                    </div>
                </div>

                <div class="sidebar-footer">
                    <button id="exportAllBtn" class="btn btn-secondary">
                        <i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®
                    </button>
                </div>
            </aside>

            <!-- å³ä¾§ï¼šå¤‡å¿˜å½•åˆ—è¡¨/ç¼–è¾‘å™¨ -->
            <section class="content-area">
                <!-- å¤‡å¿˜å½•åˆ—è¡¨è§†å›¾ -->
                <div class="memo-list-view" id="memoListView">
                    <div class="memo-list-header">
                        <h2 id="currentFolderName">è¯·é€‰æ‹©æ–‡ä»¶å¤¹</h2>
                        <div class="memo-list-actions">
                            <button id="newMemoBtn" class="btn btn-success" disabled>
                                <i class="fas fa-plus"></i> æ–°å»ºå¤‡å¿˜å½•
                            </button>
                            <button id="deleteFolderBtn" class="btn btn-danger" disabled>
                                <i class="fas fa-trash"></i> åˆ é™¤æ–‡ä»¶å¤¹
                            </button>
                        </div>
                    </div>
                    
                    <div class="memo-grid" id="memoGrid">
                        <div class="empty-state">
                            <i class="fas fa-sticky-note"></i>
                            <h3>æ¬¢è¿ä½¿ç”¨å¤‡å¿˜å½•</h3>
                            <p>é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹å¼€å§‹è®°å½•</p>
                            <p class="tip">ğŸ’¡ æ•°æ®å®æ—¶ä¿å­˜åˆ°GitHub</p>
                        </div>
                    </div>
                </div>

                <!-- ç¼–è¾‘å™¨è§†å›¾ -->
                <div class="editor-view hidden" id="editorView">
                    <div class="editor-container">
                        <!-- æ ‡é¢˜æ  -->
                        <div class="title-bar">
                            <input type="text" id="memoTitle" 
                                   placeholder="è¾“å…¥å¤‡å¿˜å½•æ ‡é¢˜..." 
                                   class="title-input" 
                                   maxlength="100">
                        </div>
                        
                        <!-- å†…å®¹åŒºåŸŸ -->
                        <div class="content-area-wrapper">
                            <textarea id="memoContent" 
                                      placeholder="å¼€å§‹è¾“å…¥å¤‡å¿˜å½•å†…å®¹..."
                                      class="content-textarea"></textarea>
                        </div>
                        
                        <!-- åº•éƒ¨å·¥å…·æ  -->
                        <div class="editor-footer">
                            <div class="editor-info">
                                <span><i class="fas fa-font"></i> <span id="charCount">0</span> å­—ç¬¦</span>
                                <span><i class="fas fa-clock"></i> <span id="lastModified">åˆšåˆš</span></span>
                            </div>
                            <div class="editor-actions">
                                <button id="exportMemoBtn" class="btn btn-secondary">
                                    <i class="fas fa-download"></i> å¯¼å‡º
                                </button>
                                <button id="deleteMemoBtn" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> åˆ é™¤
                                </button>
                                <button id="saveMemoBtn" class="btn btn-primary">
                                    <i class="fas fa-save"></i> ä¿å­˜
                                </button>
                                <button id="closeEditorBtn" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <footer class="status-bar">
    <div class="status-info">
        <span class="status-item">
            <i class="fas fa-database"></i>
            <span>å­˜å‚¨æ¨¡å¼: <span id="storageMode">æœ¬åœ°</span></span>
        </span>
        <span class="status-item">
            <i class="fas fa-sync-alt"></i>
            <span>æœ€ååŒæ­¥: <span id="lastSync" style="cursor: pointer;" title="ç‚¹å‡»æ‰‹åŠ¨åŒæ­¥">-</span></span>
        </span>
        <span class="status-item">
            <button id="forceSyncBtn" class="btn btn-sm" style="padding: 2px 8px; font-size: 12px;">
                <i class="fas fa-redo"></i> ç«‹å³åŒæ­¥
            </button>
        </span>
    </div>
</footer>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal-overlay hidden" id="modalOverlay"></div>
    
    <!-- æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div class="modal hidden" id="newFolderModal">
        <div class="modal-content">
            <h3><i class="fas fa-folder-plus"></i> æ–°å»ºæ–‡ä»¶å¤¹</h3>
            
            <div class="form-group">
                <label for="folderName">æ–‡ä»¶å¤¹åç§°</label>
                <input type="text" id="folderName" 
                       class="form-control" 
                       placeholder="ä¾‹å¦‚ï¼šå·¥ä½œç¬”è®°ã€å­¦ä¹ è®¡åˆ’" 
                       maxlength="30">
            </div>

            <div class="form-group">
                <label>æƒé™è®¾ç½®</label>
                <div class="visibility-options">
                    <label class="visibility-option">
                        <input type="radio" name="visibility" value="public" checked>
                        <div class="option-content">
                            <i class="fas fa-globe"></i>
                            <div>
                                <strong>å…¬å¼€å¯è§</strong>
                                <small>æ‰€æœ‰äººéƒ½å¯ä»¥æŸ¥çœ‹</small>
                            </div>
                        </div>
                    </label>
                    <label class="visibility-option">
                        <input type="radio" name="visibility" value="private">
                        <div class="option-content">
                            <i class="fas fa-lock"></i>
                            <div>
                                <strong>å¯†ç ä¿æŠ¤</strong>
                                <small>éœ€è¦å¯†ç æ‰èƒ½æŸ¥çœ‹</small>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group hidden" id="passwordGroup">
                <label for="folderPassword">è®¾ç½®å¯†ç </label>
                <input type="password" id="folderPassword" 
                       class="form-control" 
                       placeholder="è¾“å…¥è®¿é—®å¯†ç ï¼ˆè‡³å°‘4ä½ï¼‰">
                <small class="form-hint">è¯·è®°ä½å¯†ç ï¼Œæ— æ³•æ‰¾å›</small>
            </div>

            <div class="modal-actions">
                <button id="createFolderBtn" class="btn btn-primary">åˆ›å»ºæ–‡ä»¶å¤¹</button>
                <button id="cancelFolderBtn" class="btn btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å¯†ç è¾“å…¥æ¨¡æ€æ¡† -->
    <div class="modal hidden" id="passwordModal">
        <div class="modal-content">
            <h3><i class="fas fa-lock"></i> éœ€è¦å¯†ç </h3>
            <p>è¯·è¾“å…¥å¯†ç è®¿é—®æ­¤æ–‡ä»¶å¤¹ï¼š</p>
            
            <div class="form-group">
                <input type="password" id="inputPassword" 
                       class="form-control" 
                       placeholder="è¾“å…¥å¯†ç "
                       autocomplete="off">
            </div>

            <div class="modal-actions">
                <button id="submitPasswordBtn" class="btn btn-primary">ç¡®è®¤</button>
                <button id="cancelPasswordBtn" class="btn btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤æ¨¡æ€æ¡† -->
    <div class="modal hidden" id="confirmModal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle"></i> ç¡®è®¤åˆ é™¤</h3>
            <p id="confirmMessage">ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ</p>
            
            <div class="modal-actions">
                <button id="confirmDeleteBtn" class="btn btn-danger">ç¡®è®¤åˆ é™¤</button>
                <button id="cancelDeleteBtn" class="btn btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    
    <div class="debug-info" id="debugInfo">
        <div>ç‰ˆæœ¬: <span id="dataVersion">0</span></div>
        <div>è®¾å¤‡: <span id="deviceId">æœªçŸ¥</span></div>
        <div>çŠ¶æ€: <span id="syncStatus">ç¦»çº¿</span></div>
    </div>

    <script>
    // æ·»åŠ è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º
    document.addEventListener('DOMContentLoaded', function() {
        // å¯ä»¥æ·»åŠ è°ƒè¯•å¼€å…³
        const debugMode = localStorage.getItem('debugMode') === 'true' || true; // æš‚æ—¶è®¾ä¸ºtrueä¾¿äºè°ƒè¯•
        const debugInfo = document.getElementById('debugInfo');
        
        if (debugMode && debugInfo) {
            debugInfo.style.display = 'block';
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            setInterval(() => {
                if (window.app) {
                    document.getElementById('dataVersion').textContent = window.app.dataVersion;
                    document.getElementById('deviceId').textContent = window.app.deviceId ? window.app.deviceId.substring(0, 8) : 'æœªçŸ¥';
                    document.getElementById('syncStatus').textContent = window.app.syncing ? 'åŒæ­¥ä¸­' : (window.app.networkStatus || 'ç¦»çº¿');
                }
            }, 1000);
        }
    });
    </script>
</body>
</html>